node ('ec2_java_maven') {
    withCredentials([file(credentialsId: '6ad0a02e-19c2-4824-bb25-3c751a383d10', variable: 'MVN_SETTINGS_XML')]) {
    
        withEnv([
            "JAVA_HOME=${tool 'oracle-jdk-8'}",
            "PATH+MAVEN=${tool 'maven-3.3.9'}/bin:${env.JAVA_HOME}/bin",
            "MVN_SETTINGS_XML=${env.MVN_SETTINGS_XML}",
            // Versioning Info
            "RELEASE_VERSION=${env.RELEASE_VERSION}",
            "RELEASE_TICKET=${env.RELEASE_TICKET}",
            "RELEASE_PREFIX_RICE=${env.RELEASE_PREFIX_RICE}",
            "RELEASE_PREFIX_KFS=${env.RELEASE_PREFIX_KFS}",
            "RICE_RELEASE_VERSION=${env.RELEASE_PREFIX_RICE}${env.RELEASE_VERSION}",
            "KFS_RELEASE_VERSION=${env.RELEASE_PREFIX_KFS}${env.RELEASE_VERSION}",
            // Source Control Info
            "KFS_REPO_URL=https://github.com/ua-eas/financials.git",
            "KFS_MASTER_BRANCH=*/ua-master",
            "KFS_DEV_BRANCH=*/ua-development",
            "RICE_REPO_URL=https://github.com/ua-eas/ksd-kc5.2.1-rice",
            "RICE_DEV_BRANCH=rice-2.6-ua-development",
            "RICE_MASTER_BRANCH=*/rice-2.6-ua-master"
            ]) 
            {
                stage ('Info')
                {
                    // RCF Adding INFO messages.
                    echo "DBG: JAVA_HOME: $JAVA_HOME"
                    echo "DBG: PATH+MAVEN: $PATH+MAVEN"
                    echo "DBG: MVN_SETTINGS_XML: $MVN_SETTINGS_XML"
                    echo "DBG: RELEASE_VERSION: $RELEASE_VERSION"
                    echo "DBG: RELEASE_TICKET: $RELEASE_TICKET"
                    echo "DBG: RELEASE_PREFIX_RICE: $RELEASE_PREFIX_RICE"
                    echo "DBG: RELEASE_PREFIX_KFS: $RELEASE_PREFIX_KFS"
                    echo "DBG: RICE_RELEASE_VERSION: $RICE_RELEASE_VERSION"
                    echo "DBG: KFS_RELEASE_VERSION: $KFS_RELEASE_VERSION"
                    echo "DBG: KFS_REPO_URL: $KFS_REPO_URL"
                    echo "DBG: KFS_MASTER_BRANCH: $KFS_MASTER_BRANCH"
                    echo "DBG: KFS_DEV_BRANCH: $KFS_DEV_BRANCH"
                    echo "DBG: RICE_REPO_URL: $RICE_REPO_URL"
                    echo "DBG: RICE_DEV_BRANCH: $RICE_DEV_BRANCH"
                    echo "DBG: RICE_MASTER_BRANCH: $RICE_MASTER_BRANCH"
                }
                stage ('Create Rice Release Branch')
                {
                    withCredentials([usernamePassword(credentialsId: 'feb1872d-77aa-4ec0-be3f-c7d7d629f50e', passwordVariable: 'GIT_PASSWORD', usernameVariable: 'GIT_USERNAME')]) 
                    {
                        cleanWs()                      
                        echo "Checkout repo: " + env.RICE_REPO_URL
                        echo "Checkout Rice branch: " + env.RICE_DEV_BRANCH
                        echo "Will be using RICE_RELEASE_VERSION: " + env.RICE_RELEASE_VERSION
                        checkout([$class: 'GitSCM', branches: [[name: "*/$RICE_DEV_BRANCH"]], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'feb1872d-77aa-4ec0-be3f-c7d7d629f50e', url: env.RICE_REPO_URL]]])
                        sh "git config user.name $GIT_USERNAME"
                        sh 'git config user.email katt-toolsadm@.list.arizona.edu'
                        sh 'git config --local credential.helper "!p() { echo username=\\$GIT_USERNAME; echo password=\\$GIT_PASSWORD; }; p"'
                        // TRY CATCH
                        // Create new release branch and update POM's.
                        sh "git checkout -b RCF-$RICE_RELEASE_VERSION"
                        sh 'mvn versions:set -DgenerateBackupPoms=false -DnewVersion="$RICE_RELEASE_VERSION"'
                        sh 'git add .'
                        sh 'git status'
                        sh 'git commit -m "RCF-$RELEASE_TICKET-JenkinsRelease: Setting pom release version: $RICE_RELEASE_VERSION"'
                        sh 'git status'
                        // END: sh 'git push -u origin RCF-$NEXT_DEV_VERSION'
                        // TODO: BUMP DEVELOP VERSION BRANCH
                        sh 'git branch'
                        sh "git checkout rice-2.6-ua-development"
                        sh 'git status'
                        sh 'git branch'
                        def Integer_Value = env.RELEASE_VERSION.toInteger()
                        ++Integer_Value
                        def NEXT_DEV_VERSION="${env.RELEASE_PREFIX_RICE}$Integer_Value" + "-SNAPSHOT"
                        echo"NEXT_DEV_VERSION: $NEXT_DEV_VERSION"
                        sh 'mvn versions:set -DgenerateBackupPoms=false -DnewVersion="$NEXT_DEV_VERSION"'
                    }
                }
                stage ('Create KFS Release Branch')
                {        
                    withCredentials([usernamePassword(credentialsId: 'feb1872d-77aa-4ec0-be3f-c7d7d629f50e', passwordVariable: 'GIT_PASSWORD', usernameVariable: 'GIT_USERNAME')]) 
                    {
                        //cleanWs()
                        //echo "Checkout repo: " + env.KFS_REPO_URL
                        //echo "Checkout KFS Branch: " + env.KFS_DEV_BRANCH
                        //checkout([$class: 'GitSCM', branches: [[name: env.KFS_DEV_BRANCH]], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'feb1872d-77aa-4ec0-be3f-c7d7d629f50e', url: env.KFS_REPO_URL]]])
                        //sh "git config user.name $GIT_USERNAME"
                        //sh 'git config user.email katt-toolsadm@.list.arizona.edu'
                        //sh 'git config --local credential.helper "!p() { echo username=\\$GIT_USERNAME; echo password=\\$GIT_PASSWORD; }; p"'

                        // TRY CATCH
                        //sh "git checkout -b RCF-$NEXT_DEV_VERSION"
                        //sh 'mvn versions:set -DgenerateBackupPoms=false -DnewVersion="$CURRENT_DEV_VERSION"'
                        //sh 'git add .'
                        //sh 'git status'
                        //sh 'git commit -m "RCFJenkins: Setting pom release version: $CURRENT_DEV_VERSION"'
                        //sh 'git status'
                        
                        // sh 'git push -u origin RCF-$NEXT_DEV_VERSION'
                        // sh 'git status'
                    }
                }
            }
            
    }
}
